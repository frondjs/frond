const StateManagerObject=require("state-manager-object/source"),Navigation=require("../navigation"),domEvents=require("../domEvents");function FrondComponent(a,b){StateManagerObject.call(this,a,b),this.kit=null,this.id=null,this.idAutoAssigned=null,this.parent=null,this.roots=[],this.index=0,this.input=null,this._render="__NOT_SPECIFIED__",this.renderFn=null,this.renderFnResult=null,this.children=null,this.dontRunChildrenResolverAgain=!1,this.type=null,this.domNodeTag=null,this.domNodeType=null,this.dom=null,this.domEventListeners={},this.resolvedHTMLAttrs=null,this.needsRemount=!1,this.needsMount=!0,this.destroyed=!1,this.analytics=!0,this.router=null,this.visibility=-1,this.visibilityChanges=[]}FrondComponent.prototype=Object.create(StateManagerObject.prototype),FrondComponent.prototype.constructor=FrondComponent,FrondComponent.prototype.render=function(){this.kit.isNull(this.dom)&&(this.createDOMElement(),this.registerDOMEventListeners()),this.updateHTMLAttrs()},FrondComponent.prototype.createDOMElement=function(){this.dom="plaintext"==this.domNodeType?document.createTextNode(this.input):"html"==this.domNodeType?document.createElement(this.domNodeTag):"svg"==this.domNodeType?document.createElementNS("http://www.w3.org/2000/svg",this.domNodeTag):null},FrondComponent.prototype.registerDOMEventListeners=function(){const a=this,b=Object.keys(a._events);if(b&&0!==b.length)for(let c=0;c<b.length;c++){const d=b[c];domEvents.hasOwnProperty(d)&&(a.domEventListeners[d]=function(b){if("click"==d){const c=a.kit.getProp(a.resolvedHTMLAttrs,"href","");"#"==c.slice(0,1)&&b.preventDefault()}return a.kit.isArray(a._events[d])?a._events[d].map(function(c){return c.apply(a,[b])}):a._events[d].apply(a,[b])},a.dom.addEventListener(d,a.domEventListeners[d],!1))}},FrondComponent.prototype.updateHTMLAttrs=function(){const a=this.kit.getProp(this.input,"attrs",{}),b=this.resolveHTMLAttrs(a);this.kit.isEqual(this.resolvedHTMLAttrs,b)||(this.resolvedHTMLAttrs=b,this.patchHTMLAttrs())},FrondComponent.prototype.resolveHTMLAttrs=function(a){const b=this,c=b.kit.isObject(a)?Object.keys(a):[];return c&&0!==c.length?c.reduce(function(c,d){const e=b.resolveHTMLAttrVal(a[d],d);return(b.kit.isString(e)||"style"==d&&b.kit.isObject(e))&&(c[d]=e),c},{}):{}},FrondComponent.prototype.resolveHTMLAttrVal=function(a,b){const c=this.kit.getType(a);return"string"==c?a:"number"==c?a.toString():"object"==c&&"style"==b?a:"object"==c?JSON.stringify(a):"array"==c?JSON.stringify(a):"boolean"==c?!0===a&&"":"function"==c?this.resolveHTMLAttrVal(a.apply(this),b):"date"==c&&a.toISOString()},FrondComponent.prototype.patchHTMLAttrs=function(){const a=this,b=a.kit.isObject(a.resolvedHTMLAttrs)?Object.keys(a.resolvedHTMLAttrs):[];b&&0!==b.length&&b.map(function(b){const c=a.resolvedHTMLAttrs[b];if("style"==b&&a.kit.isObject(c)){const b=Object.keys(c);b.map(function(b){a.dom.style[b]!=c[b]&&(a.dom.style[b]=c[b])})}else a.dom.hasAttribute(b)?a.dom.getAttribute(b)!=c&&a.dom.setAttribute(b,c):a.dom.setAttribute(b,c)})},FrondComponent.prototype.updateChildren=function(){if(this.dontRunChildrenResolverAgain)return void(this.dontRunChildrenResolverAgain=!1);const a=this.resolveChildren();this.kit.isEqual(a,this.getChildren())||(this.children=a)},FrondComponent.prototype.resolveChildren=function(){return"__NOT_SPECIFIED__"==this._render&&(this._render=this.kit.getProp(this.input,"render",null)),this.kit.isFunction(this._render)?(this.renderFn=this._render,this.renderFnResult=this.renderFn.apply(this,[]),this.kit.isArray(this.renderFnResult)?Array.from(this.renderFnResult):this.kit.isNull(this.renderFnResult)?null:[this.renderFnResult]):this.kit.isArray(this._render)?Array.from(this._render):this.kit.isNull(this._render)?null:[this._render]},FrondComponent.prototype.getChildren=function(){return this.children},FrondComponent.prototype.haveChildrenChanged=function(){this.dontRunChildrenResolverAgain=!0;const a=this.resolveChildren();return!this.kit.isEqual(a,this.getChildren())&&(this.children=a,!0)},FrondComponent.prototype.shouldRemount=function(){return this.needsRemount},FrondComponent.prototype.shouldMount=function(){return this.needsMount},FrondComponent.prototype.getClassNames=function(){if(this.dom&&"plaintext"!=this.domNodeType){const a=this.dom.getAttribute("class");return this.kit.isEmpty(a)?"":a}return this.kit.getProp(this.resolvedHTMLAttrs,"class","")},FrondComponent.prototype.removeAllEventListeners=function(){const a=this,b=Object.keys(a._events);if(b&&0!==b.length)for(let c=0;c<b.length;c++){const d=b[c];domEvents.hasOwnProperty(d)&&a.dom.removeEventListener(d,a.domEventListeners[d],!1),a.removeListeners(d)}},FrondComponent.prototype.removeDOMElement=function(){this.dom&&this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom)},FrondComponent.prototype.isFullyVisible=function(){2!==this.visibility&&(this.visibility=2,this.visibilityChanges.push({v:2,t:Date.now()}),this.emit("visible"))},FrondComponent.prototype.isPartiallyVisible=function(){1!==this.visibility&&(this.visibility=1,this.visibilityChanges.push({v:1,t:Date.now()}),this.emit("partiallyVisible"))},FrondComponent.prototype.isHidden=function(){0!==this.visibility&&(this.visibility=0,this.visibilityChanges.push({v:0,t:Date.now()}),this.emit("hidden"))},FrondComponent.prototype.destroy=function(){this.emit("beforeDestroy"),this.removeAllEventListeners(),this.removeDOMElement(),this.destroyed=!0,this.emit("destroy")},FrondComponent.prototype.isStatic=function(){return this.kit.isEqual(this.getState(),{_tick:!1})},FrondComponent.prototype.getTextContent=function(){if("plaintext"==this.type){if(this.dom)return this.dom.textContent;}else if(this.dom)return this.dom.innerText;return null},FrondComponent.prototype.haveState=function(){return!this.kit.isEqual({_tick:!1},this.getState())},FrondComponent.prototype.createRouter=function(a,b){return this.router=new Navigation(a,b),this.router.kit=this.kit,this.router.build(b.components),this.router},FrondComponent.prototype.getRouter=function(){return this.router},FrondComponent.prototype.rerender=function(){this.updateState({_tick:!this.getState()._tick})},FrondComponent.prototype.isFetching=function(){return this.kit.isNull(this.getState()._data)},FrondComponent.prototype.hasFetchError=function(a){const b=this.getState()._data;if(!this.kit.isEmpty(a)){if(this.kit.getProp(b,[a,"error"]))return!0;}else if(this.kit.getProp(b,"error"))return!0;return!1},FrondComponent.prototype.data=function(){return this.getState()._data},FrondComponent.prototype.exportAs=function(a="json"){},module.exports=FrondComponent;